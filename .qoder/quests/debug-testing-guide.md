# 调试功能测试指南

## 测试准备

在测试前端调试功能之前，需要确保后端的调试接口（P0-T1）已经实现并可用。

### 必需的后端接口

1. **POST /api/sessions** - 创建会话
   - 请求体：`{ userId: string, scriptId: string, initialVariables?: object }`
   - 响应：`{ sessionId, status, createdAt, aiMessage, executionStatus }`

2. **GET /api/sessions/:id** - 获取会话详情
   - 响应：会话详情，包含messages数组

3. **GET /api/sessions/:id/messages** - 获取消息历史
   - 响应：`{ success: boolean, data: Message[] }`

4. **POST /api/sessions/:id/messages** - 发送消息
   - 请求体：`{ content: string }`
   - 响应：`{ aiMessage, sessionStatus, executionStatus }`

5. **POST /api/scripts/import** - 导入脚本
   - 请求体：`{ yamlContent: string, scriptName: string }`
   - 响应：`{ success: boolean, data: { scriptId: string } }`

## 测试步骤

### 1. 启动前端开发服务器

```bash
cd packages/script-editor
pnpm dev
```

### 2. P0-T2 验收测试（调试配置）

#### 测试点1：调试按钮可见性
- [ ] 在工程列表中，打开一个包含Session脚本的工程
- [ ] 编辑器顶部应显示"Debug"按钮（带虫子图标）
- [ ] 如果工程没有Session脚本，按钮应处于禁用状态

#### 测试点2：打开调试配置弹窗
- [ ] 点击"Debug"按钮
- [ ] 应弹出"Debug Configuration"对话框
- [ ] 对话框显示当前工程名称
- [ ] 对话框列出所有Session类型的脚本文件

#### 测试点3：选择Session脚本
- [ ] Session脚本下拉列表中应有可选项
- [ ] 可以从列表中选择一个Session脚本
- [ ] 用户ID字段默认为"debug_user"

#### 测试点4：无Session脚本时的提示
- [ ] 在没有Session脚本的工程中，应显示警告信息
- [ ] 警告信息提示"需要至少一个Session脚本"

#### 测试点5：创建调试会话
- [ ] 选择一个Session脚本
- [ ] 点击"Start Debug"按钮
- [ ] 按钮显示loading状态
- [ ] 成功后显示成功提示消息
- [ ] 配置弹窗自动关闭
- [ ] 调试对话面板自动打开

#### 测试点6：错误处理
- [ ] 如果后端接口失败，应在弹窗内显示错误信息
- [ ] 错误信息可以关闭
- [ ] 弹窗保持打开状态，允许重试

### 3. P0-T3 验收测试（调试对话面板）

#### 测试点7：面板显示
- [ ] 调试会话创建成功后，面板出现在右侧
- [ ] 面板宽度约450px
- [ ] 面板顶部显示标题"Debug Chat"
- [ ] 面板顶部显示会话ID（前8位）
- [ ] 面板有关闭按钮

#### 测试点8：初始消息加载
- [ ] 面板打开时显示"正在加载对话历史..."
- [ ] 如果有初始欢迎消息，应显示为AI消息
- [ ] AI消息背景色为浅蓝色
- [ ] AI消息左对齐

#### 测试点9：发送用户消息
- [ ] 可以在输入框中输入文本
- [ ] 点击"Send"按钮发送消息
- [ ] 或按回车键（Enter）发送消息
- [ ] Shift+Enter应换行而非发送

#### 测试点10：消息显示
- [ ] 发送后，用户消息立即显示在列表中
- [ ] 用户消息背景色为浅灰色
- [ ] 用户消息右对齐
- [ ] 消息显示时间戳

#### 测试点11：AI回复
- [ ] 发送消息后，等待AI回复
- [ ] AI回复返回后显示在消息列表中
- [ ] AI消息和用户消息视觉上有区别
- [ ] 新消息出现时，列表自动滚动到底部

#### 测试点12：连续对话
- [ ] 可以进行至少3轮连续对话
- [ ] 每轮对话都正确显示
- [ ] 消息顺序正确
- [ ] 历史消息保持可见

#### 测试点13：发送状态
- [ ] 发送消息时，输入框禁用
- [ ] 发送按钮显示loading状态
- [ ] 发送完成后，输入框恢复可用
- [ ] 发送完成后，输入框清空

#### 测试点14：错误处理
- [ ] 如果发送消息失败，显示错误提示
- [ ] 错误消息以系统消息形式显示（黄色背景）
- [ ] 用户输入的内容不丢失（可重新发送）

#### 测试点15：关闭面板
- [ ] 点击关闭按钮可以关闭面板
- [ ] 再次点击"Debug"按钮可以创建新的调试会话
- [ ] 新会话不会显示旧会话的消息

### 4. 集成测试

#### 测试点16：编辑器布局
- [ ] 调试面板打开时，不影响编辑器其他功能
- [ ] 可以继续编辑文件
- [ ] 可以切换文件
- [ ] 可以保存文件

#### 测试点17：响应式行为
- [ ] 浏览器窗口缩小时，面板仍然可见
- [ ] 面板内容适当滚动
- [ ] 消息列表滚动条正常工作

#### 测试点18：浏览器刷新
- [ ] 刷新页面后，调试会话状态丢失（预期行为）
- [ ] 需要重新创建调试会话

## 常见问题排查

### 问题1：调试按钮禁用
- 确认工程中至少有一个Session类型的文件
- 检查files数组是否正确加载

### 问题2：API调用失败
- 检查后端服务是否运行
- 检查API路径是否正确（`/api/sessions`）
- 查看浏览器控制台的网络请求
- 查看后端日志

### 问题3：消息不显示
- 检查后端返回的消息格式是否正确
- 确认messages数组结构符合预期
- 查看浏览器控制台错误

### 问题4：脚本导入失败
- 确认选中的文件有yamlContent
- 检查YAML格式是否正确
- 查看后端脚本导入接口的错误信息

## 性能测试

### 测试点19：大量消息
- [ ] 发送20条以上消息，观察性能
- [ ] 消息列表滚动流畅
- [ ] 内存占用合理

### 测试点20：并发操作
- [ ] 快速连续发送多条消息
- [ ] 系统正确处理（排队或限制）

## 验收总结

根据设计文档的验收标准：

### P0-T2验收标准
- [ ] 编辑器顶部有明显的调试入口按钮
- [ ] 点击调试按钮后显示配置弹窗
- [ ] 配置弹窗正确显示当前工程信息
- [ ] 配置弹窗正确列出所有Session类型文件
- [ ] 可以选择入口Session文件
- [ ] 点击"开始调试"后成功调用创建会话API
- [ ] API返回sessionId后保存到组件状态
- [ ] 配置成功后自动打开调试对话面板

### P0-T3验收标准
- [ ] 调试面板在编辑器右侧正确显示
- [ ] 面板打开时自动加载会话消息历史
- [ ] 消息列表正确区分AI和用户消息
- [ ] AI消息和用户消息有不同的视觉样式
- [ ] 可以在输入框中输入文本
- [ ] 点击发送按钮后消息成功发送
- [ ] 发送后用户消息立即显示在列表中
- [ ] AI回复返回后正确显示在列表中
- [ ] 消息列表自动滚动到最新消息
- [ ] 可以进行连续多轮对话（至少3轮）
- [ ] 发送消息时输入框和按钮正确禁用
- [ ] 发送完成后输入框和按钮恢复可用
- [ ] API错误时有明确的错误提示
- [ ] 可以通过关闭按钮关闭调试面板

## 备注

- 当前实现不支持刷新后恢复会话状态（符合设计预期）
- 调试面板宽度固定为450px（未来可考虑支持调整）
- 暂不支持断点、步进等高级调试功能（Phase 2）
