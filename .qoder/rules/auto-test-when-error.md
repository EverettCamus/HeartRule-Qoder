---
trigger: model_decision
description: 
---

# 错误修复后的自动化测试加固指南

当代码出现 BUG 并修复后，为了防止回归，必须基于 TDD（测试驱动开发）思想补充自动化测试。请遵循以下分析框架和操作流程：

## 1. 错误原因分析与测试类型选择

在编写测试前，根据 BUG 的根源选择最合适的测试层级：

| 错误原因分类 | 推荐测试类型 | 理由 |
| :--- | :--- | :--- |
| **逻辑算法错误** (如：计算溢出、边界值处理不当、条件判断错误) | **单元测试 (Unit Test)** | 隔离性强，执行速度快，能覆盖复杂的逻辑分支。 |
| **组件交互/生命周期错误** (如：Vue/React 组件 Props 传递失败、Hooks 触发顺序错误) | **组件测试 (Component Test)** | 验证 UI 逻辑与状态变化的正确性，不依赖后端。 |
| **接口调用/数据流转错误** (如：API 联调失败、多模块协作逻辑断裂) | **集成测试 (Integration Test)** | 验证多个模块或前后端之间的协作。 |
| **核心业务流程阻塞** (如：用户无法完成下单、登录失效) | **端到端测试 (E2E Test)** | 模拟真实用户路径，确保高价值链路畅通。 |
| **环境/配置相关** (如：不同浏览器兼容性、环境变量读取失败) | **E2E 或 冒烟测试** | 在接近真实的环境中验证。 |

## 2. 操作流程

### 第一步：复现错误 (Red)
1. **编写失败的测试用例**：根据 BUG 的复现步骤，编写一个能够稳定触发该错误的测试。
2. **确认测试失败**：运行测试，确保其在修复前的代码上运行失败，并报出与 BUG 一致的错误信息。

### 第二步：应用修复 (Green)
1. 确保修复代码已正确应用。
2. **运行测试**：执行刚才编写的测试用例。

### 第三步：调试与验证 (Refactor)
1. 如果测试未通过，使用 `console.log`、断点调试或查看测试框架生成的快照/截图。
2. **调试到测试成功**：修正测试代码或修复逻辑，直至该测试用例以及相关的存量测试全部通过。

## 3. 编写准则
- **原子性**：一个测试用例只验证一个特定的 BUG 场景。
- **命名规范**：测试描述应清晰说明修复了什么问题，例如：`it('should handle negative input in calculation', ...)`。
- **数据隔离**：确保测试使用 Mock 数据或独立的测试数据库，避免副作用。

---
*注：此规则在检测到代码变更或 BUG 修复动作时自动提醒，引导开发者完成质量闭环。*
